<mat-select [formControl]="selectFormControl" [compareWith]="idCompare"
            (focusout)="onSelectFocusLeave($event)" #select *ngIf="scrollableDataSource"
            (openedChange)="this.cdkVirtualScrollViewport.setRenderedContentOffset(0);
      this.cdkVirtualScrollViewport.setRenderedRange({start: 0, end: 9});this.selectOpenedChange($event)"
            [disableOptionCentering]="true" [multiple]="multiple" [required]="required">
  <mat-option>
    <ngx-mat-select-search [formControl]="descriptionFilterControl" #matSelectSearch
                           cdkMonitorSubtreeFocus
                           (cdkFocusChange)="searchFocused = !!$event;"
                           [clearSearchInput]="false"
                           [disableScrollToActiveOnOptionsChanged]="true"
                           noEntriesFoundLabel="No entries"
                           placeholderLabel="Search"></ngx-mat-select-search>
  </mat-option>
  <mat-select-trigger>
    <ng-container *ngIf="multiple">
      {{select.value[0]?.[this.triggerAccessor] ? select.value[0][this.triggerAccessor] : 'Loading...'}}
      <span *ngIf="select.value?.length > 1" class="additional-selection">
        (+{{select.value.length - 1}} {{select.value?.length === 2 ? 'other' : 'others'}})
      </span>
    </ng-container>
    <ng-container *ngIf="!multiple">{{select.value?.[this.triggerAccessor] ? select.value[triggerAccessor] : '[Object]'}}</ng-container>
  </mat-select-trigger>
  <cdk-virtual-scroll-viewport #cdkVirtualScrollViewport itemSize="48"
                               [style.height.px]="(scrollableDataSource.length >= 7 ? 7 : scrollableDataSource.length)*48"
                               [minBufferPx]="8*48"
                               [maxBufferPx]="16*48"
                               class="example-viewport">
    <mat-option *cdkVirtualFor="let item of scrollableDataSource" [title]="'Id: '+item?.id || ''"
                [disabled]="!item?.[triggerAccessor]"
                [value]="item">{{item?.[triggerAccessor] || 'Loading...'}}</mat-option>
  </cdk-virtual-scroll-viewport>
  <ng-container *ngIf="multiple">
    <mat-option *ngFor="let element of selectFormControl.value" [value]="element"
                style="display: none">{{element?.[this.triggerAccessor]}}</mat-option>
  </ng-container>
</mat-select>
